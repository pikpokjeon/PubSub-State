{"version":3,"file":"pubsub.js","sources":["../../src/lib/pubsub.js"],"sourcesContent":["const pipe = (initVal, ...fns) => fns.reduce((returned, fn) => fn(returned), initVal)\r\n\r\n/**\r\n * \r\n * @param {*} msg data\r\n * @param {*} sub subscriber that subscribe the data\r\n */\r\nconst Pubsub = (initData) =>\r\n{\r\n\r\n    let _store = {subs: []}\r\n\r\n    const ack = ({topic}) =>\r\n    {\r\n        if (topic === 'store') {_store.subs.forEach(sub => sub(_store))}\r\n        else\r\n        {\r\n            _store[topic].subs.forEach(sub => sub(_store[topic].data))\r\n        }\r\n    }\r\n\r\n    const subscribe = ({topic, sub}) => \r\n    {\r\n        if (topic === 'store')\r\n        {\r\n            _store.subs.push(sub)\r\n        }\r\n        else\r\n        {\r\n            if (!_store[topic]) Object.assign(_store, {[topic]: {subs: []}})\r\n            else\r\n            {\r\n                _store[topic].subs.push(sub)\r\n            }\r\n        }\r\n        return {topic}\r\n\r\n    }\r\n\r\n    const getData = (_store) => (topic) => _store[topic].data\r\n\r\n    const publish = (topic, msgs) =>\r\n    {\r\n        const prevStore = _store[topic]\r\n        const temp = {\r\n            [topic]: {\r\n                data: prevStore ? {...prevStore['data'], ...msgs} : {[Symbol.toStringTag]: topic, ...msgs},\r\n                subs: prevStore ? [...prevStore['subs']] : []\r\n            }\r\n        }\r\n\r\n        Object.assign(_store, temp)\r\n        return {topic}\r\n    }\r\n\r\n    const mutate = (topic, msgs) => [pipe(publish(topic, msgs), ack)]\r\n\r\n    const action = (topic, fn) => [pipe(publish(topic, fn(getData(_store)(topic)) ?? {}), ack)]\r\n\r\n    if (initData) Object.entries(initData).forEach(([topic, data]) => publish(topic, data))\r\n\r\n    return {mutate, publish, subscribe: (topic, sub) => subscribe({topic, sub}), getData: getData(_store), action}\r\n\r\n}\r\n\r\nmodule.exports = {Pubsub}\r\n"],"names":["pipe","initVal","fns","reduce","returned","fn","Pubsub","initData","_store","subs","ack","topic","forEach","sub","data","subscribe","push","Object","assign","getData","publish","msgs","prevStore","temp","Symbol","toStringTag","mutate","action","entries","module","exports"],"mappings":"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"}