{"version":3,"file":"pubsub.js","sources":["../../src/lib/pubsub.js"],"sourcesContent":["const pipe = (initVal, ...fns) => fns.reduce((returned, fn) => fn(returned), initVal)\r\n\r\n/**\r\n * \r\n * @param {*} msg data\r\n * @param {*} sub subscriber that subscribe the data\r\n */\r\nconst Pubsub = (initData) =>\r\n{\r\n\r\n    let _store = {subs: []}\r\n\r\n    const ack = ({topic}) =>\r\n    {\r\n        if (topic === 'store') {_store.subs.forEach(sub => sub(_store))}\r\n        else\r\n        {\r\n            _store[topic].subs.forEach(sub => sub(_store[topic].data))\r\n        }\r\n    }\r\n\r\n    const subscribe = ({topic, sub}) => \r\n    {\r\n        if (topic === 'store')\r\n        {\r\n            _store.subs.push(sub)\r\n        }\r\n        else\r\n        {\r\n            if (!_store[topic]) Object.assign(_store, {[topic]: {subs: []}})\r\n            else\r\n            {\r\n                _store[topic].subs.push(sub)\r\n            }\r\n        }\r\n        return {topic}\r\n\r\n    }\r\n\r\n    const getData = (_store) => (topic) => _store[topic].data\r\n\r\n    const publish = (topic, msgs) =>\r\n    {\r\n        const prevStore = _store[topic]\r\n        const temp = {\r\n            [topic]: {\r\n                data: prevStore ? {...prevStore['data'], ...msgs} : {[Symbol.toStringTag]: topic, ...msgs},\r\n                subs: prevStore ? [...prevStore['subs']] : []\r\n            }\r\n        }\r\n\r\n        Object.assign(_store, temp)\r\n        return {topic}\r\n    }\r\n\r\n    const mutate = (topic, msgs) => [pipe(publish(topic, msgs), ack)]\r\n\r\n    const action = (topic, fn) => [pipe(publish(topic, fn(getData(_store)(topic)) ?? {}), ack)]\r\n\r\n    if (initData) Object.entries(initData).forEach(([topic, data]) => publish(topic, data))\r\n\r\n    return {mutate, publish, subscribe: (topic, sub) => subscribe({topic, sub}), getData: getData(_store), action}\r\n\r\n}\r\n\r\nmodule.exports = {Pubsub}\r\n"],"names":["pipe","initVal","fns","reduce","returned","fn","Pubsub","initData","_store","subs","ack","topic","forEach","sub","data","subscribe","push","Object","assign","getData","publish","msgs","prevStore","temp","Symbol","toStringTag","mutate","action","entries","module","exports"],"mappings":"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"}